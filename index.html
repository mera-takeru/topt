<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pertonal -ãƒ‘ãƒ¼ãƒˆãƒŠãƒ«-</title>

  <link rel="icon" href="https://gray-magnificent-deer-836.mypinata.cloud/ipfs/bafkreigaj4jljhdjkoavf2tdarmpyzfalutwxnnmmhrb437soizt2peewe" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="canonical" href="https://pertonal.jp">
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ãƒ‘ãƒ¼ãƒˆãƒŠãƒ« - éŸ³ã¨è‰²ã®æ€§æ ¼è¨ºæ–­">
  <meta name="twitter:description" content="éŸ³ã¨è‰²ã§ã‚ãªãŸã®æ€§æ ¼ã‚’è¨ºæ–­ï¼MBTIã®æ¬¡ã¯ã‚³ãƒ¬ï¼ä»Šã™ãç„¡æ–™ã§ãƒã‚§ãƒƒã‚¯ï¼">
  <meta name="twitter:image" content="https://ipfs.io/ipfs/bafybeifuttq27ioeycupsnmuj4u2kuvjtmg4ibhtxualf6mti2yxa5abbe">
  <meta property="og:image" content="https://ipfs.io/ipfs/bafybeifuttq27ioeycupsnmuj4u2kuvjtmg4ibhtxualf6mti2yxa5abbe">

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7664351285167114"
     crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-M1HFSG9FVD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M1HFSG9FVD');
</script>

<style>
    /* ãƒ–ãƒ­ã‚°ç´¹ä»‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç”¨ã®è¿½åŠ CSS */
    #blog-section {
      width: 100%;
      max-width: 600px;
      margin: 12px auto 12px;
      padding: 12px;
      background: #fff;
      border-radius: var(--radius);
      text-align: center;
      border: 4px solid var(--primary); /* ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ã‚’é’ã« */
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    #blog-section h3 {
      font-weight: 700;
      font-size: 1.25rem;
      margin-bottom: 12px;
      color: var(--primary); /* ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ã‚’é’ã« */
      text-shadow: 
        1px 1px 2px rgba(0, 0, 0, 0.3),
        0 0 4px rgba(255, 255, 255, 0.5);
      letter-spacing: 0.5px;
    }

    .blog-description {
      font-size: 0.875rem;
      line-height: 1.6;
      color: var(--text);
      margin-bottom: 16px;
      padding: 0 12px;
      text-align: left;
    }

    #blogBtn {
      width: 100%;
    }
</style>

</head>
<body>

  <header>
    <nav class="header-nav">
      <a href="./about.html">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ«ã¨ã¯</a><span class="divider">|</span>
      <a href="./faq.html">ã‚ˆãã‚ã‚‹è³ªå•</a><span class="divider">|</span>
      <a href="https://forms.gle/PstFm54KustR4zKs6">ãŠå•ã„åˆã‚ã›</a>
    </nav>
  </header>
  
  <div class="container">
    <h1>
      <span class="title-topt">
        <span class="title-english">pertonal</span>
        <span class="title-japanese"> -ãƒ‘ãƒ¼ãƒˆãƒŠãƒ«-</span>
      </span>
      <span class="title-sub">ã€ŒéŸ³ã€Ã—ã€Œè‰²ã€ï¼ Newã€Œæ€§æ ¼è¨ºæ–­ã€</span>
    </h1>

    <div id="startScreen" class="screen active">
      <div class="start-image">
        <video autoplay loop muted playsinline alt="ãƒ¡ã‚¤ãƒ³ç”»åƒ">
          <source src="https://gray-magnificent-deer-836.mypinata.cloud/ipfs/bafybeib3kzbq5ta26g6vdaeunl7x4ptcpvnjblmcbpimlvhdqkrm3atcni" media="(min-width: 601px)" type="video/webm">
          <source src="https://gray-magnificent-deer-836.mypinata.cloud/ipfs/bafybeieecwryua54rzenirkaknhrknenmstocag6vbjykxdoxc7p3eswyq" media="(min-width: 601px)" type="video/mp4">
          <source src="https://gray-magnificent-deer-836.mypinata.cloud/ipfs/bafybeidrzsmosxgysfoavp6nfzagrfw7lprzbztsjzp4dgnfthef7jrz3m" media="(max-width: 600px)" type="video/webm">
          <source src="https://gray-magnificent-deer-836.mypinata.cloud/ipfs/bafybeiesn767okn2gtxqyipfcyngrceg2277h4emw6s2emi7yw3ozt767q" media="(max-width: 600px)" type="video/mp4">
          ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯å‹•ç”»ã®å†ç”Ÿã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚
        </video>
      </div>
      <button id="startBtn">
          <span class="arrows arrows-left">
            <span>â–¶ï¸</span>
            <span>â–¶ï¸</span>
            <span>â–¶ï¸</span>
          </span>
          <span class="btn-text"> ä»Šã™ãç„¡æ–™è¨ºæ–­ </span>
          <span class="arrows arrows-right">
            <span>â—€ï¸</span>
            <span>â—€ï¸</span>
            <span>â—€ï¸</span>
          </span>
      </button>
    </div>

    <div id="questionScreen" class="screen">
      <div class="progress-bar"><div id="progInner" class="progress-inner"></div></div>
      <div class="question"><h2 id="questionText"></h2></div>
      <ul id="optionsList" class="options"></ul>
      <div class="nav"><button id="backBtn">â—€ï¸ 1ã¤å‰ã¸</button></div>
    </div>
  </div>

  <div id="lucky-pertonal-section">
      <h3>âœ¨ä»Šæ—¥ã®ãƒ©ãƒƒã‚­ãƒ¼ãƒ‘ãƒ¼ãƒˆãƒŠãƒ«âœ¨</h3>
      <div id="lucky-pertonal-display">
        <span id="lucky-pertonal-1"></span>
        <span id="lucky-pertonal-2"></span>
      </div>
     <p class="lucky-description">ã€Œãƒ©ãƒƒã‚­ãƒ¼ãƒ‘ãƒ¼ãƒˆãƒŠãƒ«ã€ã¯ã€èª¿æ€§ã®çˆ¶ãƒ»ãƒ©ãƒ¢ãƒ¼ã®èª•ç”Ÿæ—¥ã‚’èµ·ç‚¹ã¨ã™ã‚‹ã‚ªãƒªã‚¸ãƒŠãƒ«ã®å ã„ã§ã™ã€‚éŸ³æ¥½ç†è«–ã«åŸºã¥ã„ã¦ã€å¹¸é‹ãªãƒ‘ãƒ¼ãƒˆãƒŠãƒ«ã®ãƒšã‚¢ãŒæ—¥æ›¿ã‚ã‚Šã§æ±ºã¾ã‚Šã¾ã™ã€‚</p>
  </div>

  <div id="blog-section">
    <h3>ğŸ“ãƒ¡ãƒ©ã®é–‹ç™ºè€…ãƒ–ãƒ­ã‚°ğŸ“</h3>
    <p class="blog-description">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ«ã®é–‹ç™ºç§˜è©±ã‚„å„ãƒ‘ãƒ¼ãƒˆãƒŠãƒ«ã®è©³ç´°è§£èª¬ã€ç›¸æ€§è¨ºæ–­ãªã©ã‚’ç™ºä¿¡ã—ã¦ã„ãäºˆå®šã§ã™ã€‚</p>
    <button id="blogBtn" onclick="location.href='./blog.html'">ãƒ–ãƒ­ã‚°ã‚’è¦‹ã‚‹</button>
  </div>
  <footer>
    <nav class="footer-nav">
      <a href="./terms.html">åˆ©ç”¨è¦ç´„</a><span class="divider">|</span>
      <a href="./privacy.html">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a><span class="divider">|</span>
      <a href="./operator.html">é‹å–¶è€…æƒ…å ±</a>
    </nav>
    <p class="copyright">&copy; 2025 pertonal by mera takeru. All rights reserved.</p>
  </footer>

  <script src="data.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- è¨ºæ–­ã‚¯ã‚¤ã‚ºã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ  (æ—¢å­˜ã®ã¾ã¾) ---
      let currentQuestionIndex = 0;
      const userAnswers = Array(questions.length).fill(null);
      let isSubmitting = false;

      const startBtn = document.getElementById('startBtn');
      const backBtn = document.getElementById('backBtn');
      const startScreen = document.getElementById('startScreen');
      const questionScreen = document.getElementById('questionScreen');
      const questionText = document.getElementById('questionText');
      const optionsList = document.getElementById('optionsList');
      const progInner = document.getElementById('progInner');

      function showScreen(screen) {
        startScreen.classList.remove('active');
        questionScreen.classList.remove('active');
        screen.classList.add('active');
      }

      function renderQuestion() {
        const q = questions[currentQuestionIndex];
        questionText.textContent = q.text;
        progInner.style.width = `${(currentQuestionIndex / questions.length) * 100}%`;
        optionsList.innerHTML = '';

        q.options.forEach((opt, idx) => {
          const li = document.createElement('li');
          if (userAnswers[currentQuestionIndex] === idx) {
            li.classList.add('selected');
          }
          const btn = document.createElement('button');
          btn.textContent = opt.text;
          btn.onclick = () => {
            userAnswers[currentQuestionIndex] = idx;
            if (currentQuestionIndex < questions.length - 1) {
              currentQuestionIndex++;
              renderQuestion();
            } else {
              calculateAndRedirect();
            }
          };
          li.appendChild(btn);
          optionsList.appendChild(li);
        });
        backBtn.style.display = currentQuestionIndex > 0 ? 'inline-block' : 'none';
      }

      function calculateAndRedirect() {
        if (isSubmitting) return;
        isSubmitting = true;

        const tieBreakerOrder = ["C", "am", "G", "em", "F", "dm", "D", "bm", "Bâ™­", "gm", "A", "fâ™¯m", "Eâ™­", "cm", "E", "câ™¯m", "Aâ™­", "fm", "B", "gâ™¯m", "Dâ™­", "bâ™­m", "Fâ™¯", "eâ™­m"];
        const totals = {};
        questions.forEach((q, qi) => {
          const selectedOptionIndex = userAnswers[qi];
          if (selectedOptionIndex !== null) {
            const points = q.options[selectedOptionIndex].points;
            Object.entries(points).forEach(([key, value]) => {
              totals[key] = (totals[key] || 0) + value;
            });
          }
        });
        if (Object.keys(totals).length === 0) {
          alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
          showScreen(startScreen);
          isSubmitting = false;
          return;
        }
        const maxScore = Math.max(...Object.values(totals));
        const tiedResults = Object.keys(totals).filter(key => totals[key] === maxScore);
        let resultKey;
        if (tiedResults.length > 1) {
          resultKey = tieBreakerOrder.find(key => tiedResults.includes(key));
        } else {
          resultKey = tiedResults[0];
        }

        if (resultKey) {
          try {
            const webAppUrl = 'https://script.google.com/macros/s/AKfycby85hMd3E8tD_p5JGqQG_eG4PMW-TFCg0EHhSOY7Eoht-CSoiDuG_2eqfgBWOvYaOM/exec';
            const data = JSON.stringify({ partonal: resultKey });
            if (navigator.sendBeacon) {
              navigator.sendBeacon(webAppUrl, data);
            } else {
              fetch(webAppUrl, { method: 'POST', body: data, mode: 'no-cors', keepalive: true });
            }
          } catch (error) {
            console.error('çµæœã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          }
          const fileName = resultKey.replace('â™¯', 's').replace('â™­', 'b');
          window.location.href = `${fileName}.html`;
        } else {
          alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
          showScreen(startScreen);
          isSubmitting = false;
        }
      }

      startBtn.onclick = () => {
        document.getElementById('lucky-pertonal-section').style.display = 'none';
        document.getElementById('blog-section').style.display = 'none'; // â˜…â˜…â˜…ãƒ–ãƒ­ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚‚éè¡¨ç¤ºã«â˜…â˜…â˜…
        currentQuestionIndex = 0;
        userAnswers.fill(null);
        renderQuestion();
        showScreen(questionScreen);
      };

      backBtn.onclick = () => {
        if (currentQuestionIndex > 0) {
          currentQuestionIndex--;
          renderQuestion();
        }
      };
      
      // --- ã“ã“ã‹ã‚‰ãŒãƒ©ãƒƒã‚­ãƒ¼ãƒ‘ãƒ¼ãƒˆãƒŠãƒ«ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã™ ---
      function displayLuckyPertonal() {
        const startDate = new Date('1683-09-25T00:00:00Z');
        const now = new Date();
        // ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’æ—¥æœ¬æ™‚é–“ã«å›ºå®šã—ã¦ä»Šæ—¥ã®æ—¥ä»˜ã‚’å–å¾—
        const today = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Tokyo"}));
        today.setHours(0, 0, 0, 0);

        const pertonalPairs = [
          { major: "C", minor: "am" }, { major: "G", minor: "em" },
          { major: "D", minor: "bm" }, { major: "A", minor: "fâ™¯m" },
          { major: "E", minor: "câ™¯m" }, { major: "B", minor: "gâ™¯m" },
          { major: "Fâ™¯", minor: "eâ™­m" }, { major: "Dâ™­", minor: "bâ™­m" },
          { major: "Aâ™­", minor: "fm" }, { major: "Eâ™­", minor: "cm" },
          { major: "Bâ™­", minor: "gm" }, { major: "F", minor: "dm" }
        ];

        const elapsedMilliseconds = today - startDate;
        const elapsedDays = Math.floor(elapsedMilliseconds / (1000 * 60 * 60 * 24));
        const luckyIndex = elapsedDays % 12;

        const luckyPair = pertonalPairs[luckyIndex];
        
        function getCharacterTitle(key) {
          const description = characterDescriptions[key];
          if (!description) return `ã€${key}å‹ã€‘`;
          const match = description.match(/<span class="title"[^>]*>ã€.*?ã€‘(.*?)<\/span>/);
          return match ? `ã€${key}å‹ã€‘${match[1]}` : `ã€${key}å‹ã€‘`;
        }

        const luckyPertonal1 = document.getElementById('lucky-pertonal-1');
        const luckyPertonal2 = document.getElementById('lucky-pertonal-2');

        luckyPertonal1.textContent = getCharacterTitle(luckyPair.major);
        luckyPertonal1.style.backgroundColor = personalityColors[luckyPair.major].code;
        
        luckyPertonal2.textContent = getCharacterTitle(luckyPair.minor);
        luckyPertonal2.style.backgroundColor = personalityColors[luckyPair.minor].code;
      }

      displayLuckyPertonal();
    });

      // --- ã“ã“ã‹ã‚‰ãŒå‹•ç”»å†ç”Ÿã®ä¸å…·åˆå¯¾ç­–ã‚³ãƒ¼ãƒ‰ã§ã™ ---
      const videoElement = document.querySelector('#startScreen video');
      if (videoElement) {
        videoElement.play().catch(error => {
          console.log("Autoplay failed, waiting for user interaction.", error);
          document.body.addEventListener('touchstart', () => {
            videoElement.play();
          }, { once: true });
        });
      }
  </script>

</body>
</html>
